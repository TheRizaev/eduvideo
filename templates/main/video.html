{% extends 'main/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ video.title }} - KRONIK{% endblock %}

{% block head %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π –ø–ª–µ–µ—Ä -->
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

<!-- –ù–∞—à–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä–∞ -->
<link href="{% static 'css/video-player.css' %}" rel="stylesheet" />

<!-- –í–∞–∂–Ω–æ: —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–∞–≥–∏–Ω, –∑–∞—Ç–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç KronikPlayer -->
<script src="{% static 'js/video-player.js' %}"></script>
{% endblock %}

{% block content %}
<div class="video-page-layout">
    <div class="video-content">
        <div class="video-player-container">
            <div class="video-player">
                <video
                    id="kronik-player"
                    class="video-js vjs-big-play-centered vjs-theme-kronik"
                    controls
                    preload="auto"
                    poster="{% if video.thumbnail %}{{ video.thumbnail.url }}{% else %}{% static 'placeholder.jpg' %}{% endif %}"
                    data-setup="{}"
                >
                    <!-- –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥—É—Ç —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤ -->
                    <source src="{{ video.video_file.url|default:'#' }}" type="video/mp4" label="720p" />
                    <source src="{{ video.video_file.url|default:'#' }}" type="video/mp4" label="480p" />
                    <source src="{{ video.video_file.url|default:'#' }}" type="video/mp4" label="360p" />
                    
                    <p class="vjs-no-js">
                        –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –≤–∫–ª—é—á–∏—Ç–µ JavaScript –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –¥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–≥–æ HTML5 –≤–∏–¥–µ–æ.
                    </p>
                </video>
            </div>
            
            <div class="video-details">
                <h1>{{ video.title }}</h1>
                <div class="video-info-bar">
                    <div class="views-info">{{ video.views }} ‚Ä¢ {{ video.age }}</div>
                    <div class="actions-bar">
                        <button class="action-button" id="likeButton">üëç <span id="likeCount">0</span></button>
                        <button class="action-button" id="dislikeButton">üëé <span id="dislikeCount">0</span></button>
                        <button class="action-button">‚ÜóÔ∏è –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                        <button class="action-button">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="channel-info">
                    <div class="channel-avatar">{{ video.channel|first }}</div>
                    <div class="channel-details">
                        <div class="channel-name">{{ video.channel }}</div>
                        <div class="subscribers">10K –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
                    </div>
                    <button class="subscribe-button">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                </div>
                
                <div class="video-description">
                    <p>{{ video.description|default:"–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–µ–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç." }}</p>
                </div>
            </div>
            
            <div class="comments-section">
                <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
                <div class="comment-form">
                    <div class="user-avatar">{% if user.is_authenticated %}{{ user.username|first }}{% else %}–ì{% endif %}</div>
                    <input type="text" placeholder="{% if user.is_authenticated %}–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...{% else %}–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å{% endif %}" {% if not user.is_authenticated %}disabled{% endif %}>
                </div>
                
                <div class="comments-list">
                    {% if comments %}
                        {% for comment in comments %}
                        <div class="comment">
                            <div class="comment-avatar">{{ comment.user.username|first }}</div>
                            <div class="comment-content">
                                <div class="comment-author">{{ comment.user.username }}</div>
                                <div class="comment-text">{{ comment.content }}</div>
                                <div class="comment-meta">{{ comment.created_at|naturaltime }}</div>
                                <div class="comment-actions">
                                    <button class="comment-like">üëç <span>{{ comment.likes|default:"0" }}</span></button>
                                    <button class="comment-dislike">üëé</button>
                                    <button class="comment-reply">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                                </div>
                                
                                {% if comment.replies.exists %}
                                <div class="comment-replies">
                                    {% for reply in comment.replies.all %}
                                    <div class="reply">
                                        <div class="comment-avatar">{{ reply.user.username|first }}</div>
                                        <div class="comment-content">
                                            <div class="comment-author">{{ reply.user.username }}</div>
                                            <div class="comment-text">{{ reply.content }}</div>
                                            <div class="comment-meta">{{ reply.created_at|naturaltime }}</div>
                                            <div class="comment-actions">
                                                <button class="comment-like">üëç <span>{{ reply.likes|default:"0" }}</span></button>
                                                <button class="comment-dislike">üëé</button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="comment">
                            <div class="comment-avatar">–ö</div>
                            <div class="comment-content">
                                <div class="comment-author">–ö–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä</div>
                                <div class="comment-text">–û—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ–µ –≤–∏–¥–µ–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ.</div>
                                <div class="comment-meta">2 –¥–Ω—è –Ω–∞–∑–∞–¥</div>
                                <div class="comment-actions">
                                    <button class="comment-like">üëç <span>24</span></button>
                                    <button class="comment-dislike">üëé</button>
                                    <button class="comment-reply">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="related-videos">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–∏–¥–µ–æ</h3>
        <div class="related-videos-list" id="related-videos-container">
            <!-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–∏–¥–µ–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é JavaScript -->
        </div>
    </div>
</div>

<!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å –æ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à–∞—Ö -->
<div class="keyboard-shortcuts-info">
    <button class="shortcuts-toggle">‚å®Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</button>
    <div class="shortcuts-panel" style="display: none;">
        <h3>–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h3>
        <ul>
            <li><span class="key">–ü—Ä–æ–±–µ–ª</span> - –ü–∞—É–∑–∞/–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</li>
            <li><span class="key">‚Üí</span> - –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –≤–ø–µ—Ä–µ–¥ –Ω–∞ 10 —Å–µ–∫</li>
            <li><span class="key">‚Üê</span> - –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥ –Ω–∞ 10 —Å–µ–∫</li>
            <li><span class="key">‚Üë</span> - –£–≤–µ–ª–∏—á–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å</li>
            <li><span class="key">‚Üì</span> - –£–º–µ–Ω—å—à–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å</li>
            <li><span class="key">F</span> - –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</li>
            <li><span class="key">M</span> - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞</li>
            <li><span class="key">0-9</span> - –ü–µ—Ä–µ—Ö–æ–¥ –∫ % –≤–∏–¥–µ–æ (0 = –Ω–∞—á–∞–ª–æ, 5 = 50%, 9 = 90%)</li>
        </ul>
    </div>
</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä –∏ –æ–∫–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ
    document.addEventListener('DOMContentLoaded', function() {
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ VideoJS (videojs) –∑–∞–≥—Ä—É–∂–µ–Ω
        if (typeof videojs === 'undefined') {
            console.error('VideoJS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–∞—à KronikPlayer –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
        if (typeof KronikPlayer === 'undefined') {
            console.error('KronikPlayer –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω —Ñ–∞–π–ª video-player.js');
            
            // –ï—Å–ª–∏ KronikPlayer –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π VideoJS
            try {
                const player = videojs('kronik-player');
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π VideoJS –ø–ª–µ–µ—Ä –≤–º–µ—Å—Ç–æ KronikPlayer');
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ VideoJS:', err);
            }
            return;
        }
        
        // –ï—Å–ª–∏ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—à –ø–ª–µ–µ—Ä
        try {
            const player = new KronikPlayer('kronik-player', {
                videoId: '{{ video.id }}',
                showNextVideo: true,
                nextVideoSelector: '.related-video-card:first-child',
                nextTitleSelector: '.related-title',
                nextChannelSelector: '.related-channel',
                trackWatchProgress: true,
                trackWatchComplete: true
            });
            console.log('KronikPlayer —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ KronikPlayer:', err);
            
            // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π VideoJS
            try {
                const player = videojs('kronik-player');
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π VideoJS –ø–ª–µ–µ—Ä –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç');
            } catch (err2) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ VideoJS:', err2);
            }
        }
        
        // –ü–∞–Ω–µ–ª—å –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
        const shortcutsToggle = document.querySelector('.shortcuts-toggle');
        const shortcutsPanel = document.querySelector('.shortcuts-panel');
        
        if (shortcutsToggle && shortcutsPanel) {
            shortcutsToggle.addEventListener('click', function() {
                if (shortcutsPanel.style.display === 'none') {
                    shortcutsPanel.style.display = 'block';
                    this.textContent = '‚å®Ô∏è –°–∫—Ä—ã—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏';
                } else {
                    shortcutsPanel.style.display = 'none';
                    this.textContent = '‚å®Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏';
                }
            });
        }
    });
</script>
{% endblock %}