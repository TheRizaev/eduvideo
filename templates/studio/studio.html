{% extends 'main/base.html' %}
{% load static %}

{% block title %}–°—Ç—É–¥–∏—è - KRONIK{% endblock %}

{% block content %}
<div class="studio-container">
    <div class="studio-header">
        <h1>–°—Ç—É–¥–∏—è KRONIK <span class="bunny-icon">üê∞</span></h1>
        <button class="upload-button" id="showUploadForm">
            <span class="upload-icon">üì§</span>
            <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</span>
        </button>
    </div>

    <!-- Upload Form Modal -->
    <div id="uploadModal" class="upload-modal">
        <div class="upload-modal-content">
            <div class="upload-modal-header">
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="upload-modal-body">
                <div class="upload-progress-container" style="display: none;">
                    <div class="upload-progress-status">
                        <div class="upload-step active" data-step="prepare">
                            <div class="step-icon">üìë</div>
                            <div class="step-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</div>
                        </div>
                        <div class="upload-step" data-step="upload">
                            <div class="step-icon">üöÄ</div>
                            <div class="step-text">–ó–∞–≥—Ä—É–∑–∫–∞</div>
                        </div>
                        <div class="upload-step" data-step="process">
                            <div class="step-icon">‚öôÔ∏è</div>
                            <div class="step-text">–û–±—Ä–∞–±–æ—Ç–∫–∞</div>
                        </div>
                        <div class="upload-step" data-step="complete">
                            <div class="step-icon">‚úÖ</div>
                            <div class="step-text">–ì–æ—Ç–æ–≤–æ</div>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar"></div>
                    </div>
                    <div class="progress-percentage">0%</div>
                    <div class="progress-message">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ...</div>
                </div>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="video_file">–í–∏–¥–µ–æ —Ñ–∞–π–ª <span class="required">*</span></label>
                        <div class="file-input-container">
                            <input type="file" id="video_file" name="video_file" accept="video/*" required>
                            <div class="file-input-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∏–¥–µ–æ —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                            <div class="file-preview"></div>
                        </div>
                        <div class="form-help">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP4, MOV, AVI, MKV (–º–∞–∫—Å. 500 –ú–ë)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="thumbnail">–ú–∏–Ω–∏–∞—Ç—é—Ä–∞ (–ø—Ä–µ–≤—å—é)</label>
                        <div class="file-input-container">
                            <input type="file" id="thumbnail" name="thumbnail" accept="image/*">
                            <div class="file-input-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                            <div class="thumbnail-preview"></div>
                        </div>
                        <div class="form-help">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1280√ó720, —Ñ–æ—Ä–º–∞—Ç: JPG, PNG (–º–∞–∫—Å. 2 –ú–ë)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ <span class="required">*</span></label>
                        <input type="text" id="title" name="title" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="description" name="description" class="form-textarea" rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="category" name="category" class="form-select">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                            <!-- –ó–∞–≥–ª—É—à–∫–∏ –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å -->
                            <option value="1">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="2">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
                            <option value="3">–§–∏–∑–∏–∫–∞</option>
                            <option value="4">–•–∏–º–∏—è</option>
                            <option value="5">–ò—Å—Ç–æ—Ä–∏—è</option>
                            <option value="6">–ë–∏–æ–ª–æ–≥–∏—è</option>
                            <option value="7">–≠–∫–æ–Ω–æ–º–∏–∫–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="upload-submit-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        <button type="button" class="upload-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
                
                <div class="upload-success" style="display: none;">
                    <div class="success-icon">‚úÖ</div>
                    <h3>–í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!</h3>
                    <p>–í–∞—à–µ –≤–∏–¥–µ–æ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.</p>
                    <button class="close-success-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div class="studio-tabs">
        <div class="tab active" data-tab="videos">–í–∏–¥–µ–æ</div>
        <div class="tab" data-tab="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
        <div class="tab" data-tab="comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
        <div class="tab" data-tab="monetization">–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è</div>
        <div class="tab" data-tab="customization">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</div>
    </div>

    <div class="tab-content" id="videos-content">
        <div class="studio-filter">
            <div class="filter-group">
                <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤–∏–¥–µ–æ..." class="search-input">
                <button class="search-button">üîç</button>
            </div>
            <div class="filter-group">
                <select class="filter-select">
                    <option>–í—Å–µ –≤–∏–¥–µ–æ</option>
                    <option>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ</option>
                    <option>–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</option>
                    <option>–ê—Ä—Ö–∏–≤–Ω—ã–µ</option>
                </select>
                <select class="filter-select">
                    <option>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</option>
                    <option>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ)</option>
                    <option>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º</option>
                    <option>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ü–µ–Ω–∫–∞–º</option>
                </select>
            </div>
        </div>

        <div class="studio-videos-list">
            {% if videos %}
                {% for video in videos %}
                <div class="studio-video-item">
                    <div class="video-thumbnail">
                        {% if video.thumbnail %}
                            <img src="{{ video.thumbnail.url }}" alt="{{ video.title }}">
                        {% else %}
                            <div class="placeholder-thumbnail">üê∞</div>
                        {% endif %}
                        <span class="video-duration">{{ video.duration }}</span>
                    </div>
                    <div class="video-details">
                        <h3 class="video-title">{{ video.title }}</h3>
                        <div class="video-meta">
                            {{ video.views }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Ä¢ {{ video.upload_date|date:"d.m.Y" }}
                        </div>
                        <div class="video-category">
                            –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ video.category|default:"–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" }}
                        </div>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn edit-btn" data-id="{{ video.id }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-btn stats-btn" data-id="{{ video.id }}">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                        <button class="action-btn delete-btn" data-id="{{ video.id }}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-videos">
                    <div class="empty-state">
                        <div class="empty-icon">üê∞</div>
                        <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ</h3>
                        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –¥–µ–ª–∏—Ç—å—Å—è –∑–Ω–∞–Ω–∏—è–º–∏</p>
                        <button class="upload-button" id="emptyStateUploadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</button>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="tab-content hidden" id="analytics-content">
        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    </div>

    <div class="tab-content hidden" id="comments-content">
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    </div>

    <div class="tab-content hidden" id="monetization-content">
        <!-- –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    </div>

    <div class="tab-content hidden" id="customization-content">
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    const tabs = document.querySelectorAll('.tab');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs
            tabs.forEach(t => t.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Hide all tab content
            const allContent = document.querySelectorAll('.tab-content');
            allContent.forEach(content => content.classList.add('hidden'));
            
            // Show selected tab content
            const tabName = this.getAttribute('data-tab');
            const selectedContent = document.getElementById(`${tabName}-content`);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }
        });
    });
    
    // Modal functionality
    const modal = document.getElementById('uploadModal');
    const showModalBtn = document.getElementById('showUploadForm');
    const closeModalBtn = document.querySelector('.close-modal');
    const cancelBtn = document.querySelector('.upload-cancel-btn');
    const emptyStateUploadBtn = document.getElementById('emptyStateUploadBtn');
    
    // Show modal
    function showModal() {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
    
    // Hide modal
    function hideModal() {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // Restore scrolling
        
        // Reset form
        document.getElementById('uploadForm').reset();
        document.querySelector('.file-preview').style.display = 'none';
        document.querySelector('.thumbnail-preview').style.display = 'none';
        document.querySelector('.upload-progress-container').style.display = 'none';
        document.querySelector('.upload-success').style.display = 'none';
        document.getElementById('uploadForm').style.display = 'block';
    }
    
    if (showModalBtn) showModalBtn.addEventListener('click', showModal);
    if (closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
    if (cancelBtn) cancelBtn.addEventListener('click', hideModal);
    if (emptyStateUploadBtn) emptyStateUploadBtn.addEventListener('click', showModal);
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            hideModal();
        }
    });
    
    // File input preview
    const videoInput = document.getElementById('video_file');
    const thumbnailInput = document.getElementById('thumbnail');
    const videoPreview = document.querySelector('.file-preview');
    const thumbnailPreview = document.querySelector('.thumbnail-preview');
    
    if (videoInput) {
        videoInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                // Update file input text
                this.parentNode.querySelector('.file-input-text').textContent = file.name;
                
                // Show video preview
                videoPreview.innerHTML = `
                    <video controls>
                        <source src="${URL.createObjectURL(file)}" type="${file.type}">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ.
                    </video>
                    <div class="file-info">
                        <div>–ò–º—è: ${file.name}</div>
                        <div>–†–∞–∑–º–µ—Ä: ${formatFileSize(file.size)}</div>
                    </div>
                `;
                videoPreview.style.display = 'block';
            }
        });
    }
    
    if (thumbnailInput) {
        thumbnailInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                // Update file input text
                this.parentNode.querySelector('.file-input-text').textContent = file.name;
                
                // Show thumbnail preview
                thumbnailPreview.innerHTML = `
                    <img src="${URL.createObjectURL(file)}" alt="–ü—Ä–µ–≤—å—é –º–∏–Ω–∏–∞—Ç—é—Ä—ã">
                    <div class="file-info">
                        <div>–ò–º—è: ${file.name}</div>
                        <div>–†–∞–∑–º–µ—Ä: ${formatFileSize(file.size)}</div>
                    </div>
                `;
                thumbnailPreview.style.display = 'block';
            }
        });
    }
    
    // Format file size
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 –ë–∞–π—Ç';
        const k = 1024;
        const sizes = ['–ë–∞–π—Ç', '–ö–ë', '–ú–ë', '–ì–ë'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Form submission
    const uploadForm = document.getElementById('uploadForm');
    
    if (uploadForm) {
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            const videoFile = document.getElementById('video_file').files[0];
            const title = document.getElementById('title').value.trim();
            
            if (!videoFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
                return;
            }
            
            if (!title) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ');
                return;
            }
            
            // Show progress container
            const progressContainer = document.querySelector('.upload-progress-container');
            progressContainer.style.display = 'block';
            
            // Hide form
            uploadForm.style.display = 'none';
            
            // Create FormData object
            const formData = new FormData(uploadForm);
            
            // Simulate upload process with GCS
            simulateUpload(formData);
        });
    }
    
    // Function to simulate the upload process with GCS integration
    function simulateUpload(formData) {
        const progressBar = document.querySelector('.progress-bar');
        const progressPercentage = document.querySelector('.progress-percentage');
        const progressMessage = document.querySelector('.progress-message');
        const steps = document.querySelectorAll('.upload-step');
        
        // Set current step to "upload"
        updateStep('upload');
        
        let progress = 0;
        const interval = setInterval(function() {
            progress += 5;
            progressBar.style.width = progress + '%';
            progressPercentage.textContent = progress + '%';
            
            if (progress === 50) {
                progressMessage.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ Google Cloud Storage...';
            }
            
            if (progress === 75) {
                updateStep('process');
                progressMessage.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ...';
            }
            
            if (progress >= 100) {
                clearInterval(interval);
                progressBar.style.width = '100%';
                progressPercentage.textContent = '100%';
                progressMessage.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!';
                updateStep('complete');
                
                // In a real implementation, this is where you would make an AJAX call to upload to GCS
                // For demonstration, we'll show success after a delay
                setTimeout(function() {
                    document.querySelector('.upload-progress-container').style.display = 'none';
                    document.querySelector('.upload-success').style.display = 'block';
                }, 1000);
            }
        }, 200);
        
        // Function to update the current step in progress indicator
        function updateStep(stepName) {
            steps.forEach(step => {
                if (step.getAttribute('data-step') === stepName) {
                    step.classList.add('active');
                    
                    // Mark previous steps as complete
                    let prevStep = step.previousElementSibling;
                    while (prevStep) {
                        prevStep.classList.remove('active');
                        prevStep.classList.add('complete');
                        prevStep = prevStep.previousElementSibling;
                    }
                }
            });
        }
    }
    
    // In a real implementation, this would make a POST request to your Django backend
    function uploadToGCS(formData) {
        return fetch('/api/upload-video/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        });
    }
    
    // Close success message
    const closeSuccessBtn = document.querySelector('.close-success-btn');
    if (closeSuccessBtn) {
        closeSuccessBtn.addEventListener('click', function() {
            hideModal();
            // In a real implementation, you might want to refresh the video list
            // window.location.reload();
        });
    }
    
    // Delete video button functionality
    const deleteButtons = document.querySelectorAll('.delete-btn');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const videoId = this.getAttribute('data-id');
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–∏–¥–µ–æ?')) {
                // Here you would make an AJAX call to delete the video from GCS
                console.log('–£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ —Å ID:', videoId);
                // In a real implementation:
                // deleteVideoFromGCS(videoId);
            }
        });
    });
    
    // Function to delete video from GCS (simulated)
    function deleteVideoFromGCS(videoId) {
        fetch(`/api/delete-video/${videoId}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Remove video from DOM
            document.querySelector(`.studio-video-item[data-id="${videoId}"]`).remove();
        })
        .catch(error => {
            console.error('Error deleting video:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤–∏–¥–µ–æ.');
        });
    }
    
    // Edit video button functionality
    const editButtons = document.querySelectorAll('.edit-btn');
    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const videoId = this.getAttribute('data-id');
            console.log('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ —Å ID:', videoId);
            // In a real implementation, you would fetch video details and populate a form
            alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        });
    });
    
    // Stats button functionality
    const statsButtons = document.querySelectorAll('.stats-btn');
    statsButtons.forEach(button => {
        button.addEventListener('click', function() {
            const videoId = this.getAttribute('data-id');
            console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–µ–æ —Å ID:', videoId);
            // Switch to analytics tab and show specific video stats
            document.querySelector('[data-tab="analytics"]').click();
        });
    });
    
    // Drag and drop file upload
    const fileContainers = document.querySelectorAll('.file-input-container');
    fileContainers.forEach(container => {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            container.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            container.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            container.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            container.classList.add('highlight');
        }
        
        function unhighlight() {
            container.classList.remove('highlight');
        }
        
        container.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const fileInput = container.querySelector('input[type="file"]');
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                fileInput.files = files;
                
                // Trigger change event
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        }
    });
});
</script>
{% endblock%}